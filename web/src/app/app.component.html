<div class="identity-bar">
  <div class="identity-label">
    <span class="meta-id" title="Meta Account ID">Meta: {{ currentMetaId || 'Default' }}</span>
    <button class="switch-btn" (click)="switchMetaAccount()">Switch</button>
  </div>

  <div style="margin-left: 10px; font-size: 0.85rem; color: #94a3b8; margin-right: 10px;">
      Context:
  </div>

  <div class="identity-list">
    <button
      *ngFor="let id of identities"
      class="identity-chip"
      [class.active]="activeIdentityId === id.id"
      (click)="setContextIdentity(id.id)">
      <span class="icon">üë§</span>
      <span>{{ id.acct }}</span>
    </button>

    <div *ngIf="identities.length === 0" style="color: #64748b; font-style: italic;">
        No identities found. Add one in Admin.
    </div>
  </div>
</div>

<div class="app-layout">
  <div class="header">
    <h1 style="font-size: 1.5rem; margin:0;">Mastodon Blog</h1>
    <nav>
      <a routerLink="/" style="margin-right: 15px;">Read</a>
      <a routerLink="/admin">Write (Admin)</a>
    </nav>
  </div>

  <!-- Active User Display -->
  <div class="active-user-card" *ngIf="activeUserInfo">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
      <img [src]="activeUserInfo.avatar"
           style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid #6366f1;">
      <div>
        <h3 style="margin: 0; font-size: 1.1rem;">{{ activeUserInfo.display_name || activeUserInfo.acct }}</h3>
        <div class="muted" style="font-size: 0.85rem;">@{{ activeUserInfo.acct }}</div>
      </div>
    </div>
    <div *ngIf="activeUserInfo.note"
         [innerHTML]="activeUserInfo.note"
         style="font-size: 0.9rem; color: #555; line-height: 1.5;">
    </div>
  </div>

  <div class="sidebar-left">
    <!-- Home Button (Return to Main User) -->
    <button class="nav-btn"
            [class.active]="isViewingMainUser()"
            (click)="viewMainUser()"
            style="background: #6366f1; color: white; font-weight: 600; margin-bottom: 5px;">
      üè† My Blog
    </button>

    <!-- Everyone Button -->
    <button class="nav-btn"
            [class.active]="viewingEveryone"
            (click)="viewEveryone()"
            style="background: #f59e0b; color: white; font-weight: 600; margin-bottom: 5px;">
      üåç Everyone's Blog
    </button>

    <!-- Next Blog Button -->
    <button class="nav-btn"
            (click)="viewNextBlogrollUser()"
            [disabled]="blogRoll.length === 0"
            style="background: #10b981; color: white; font-weight: 600; margin-bottom: 15px;">
      ‚è≠Ô∏è Next Blog
    </button>

    <hr>

    <div class="muted" style="margin-bottom:10px;">BLOG ROLL FILTERS</div>
    <button class="nav-btn" [class.active]="currentBlogFilter==='top_friends'" (click)="setBlogFilter('top_friends')">Top Friends</button>
    <button class="nav-btn" [class.active]="currentBlogFilter==='mutuals'" (click)="setBlogFilter('mutuals')">Mutuals</button>
    <button class="nav-btn" [class.active]="currentBlogFilter==='chatty'" (click)="setBlogFilter('chatty')">Chatty</button>
    <button class="nav-btn" [class.active]="currentBlogFilter==='broadcasters'" (click)="setBlogFilter('broadcasters')">Broadcasters</button>
    <button class="nav-btn" [class.active]="currentBlogFilter==='bots'" (click)="setBlogFilter('bots')">Bots</button>
    <button class="nav-btn" [class.active]="currentBlogFilter==='all'" (click)="setBlogFilter('all')">All</button>

    <hr>

    <div class="muted" style="margin-bottom:10px;">BLOG ROLL</div>
    <div *ngIf="blogRoll.length === 0" class="muted" style="font-style: italic; font-size: 0.85rem;">
        No friends found for this identity.
    </div>

    <div *ngFor="let acc of blogRoll" style="margin-bottom: 8px;">
      <a [routerLink]="['/']"
         [queryParams]="{user: acc.acct}"
         (click)="prefetchNextBlogrollUser(acc.acct)"
         queryParamsHandling="merge"
         [style.background]="isActiveUser(acc.acct) ? '#e0e7ff' : (isRecentlyViewed(acc.acct) ? '#f3f4f6' : 'transparent')"
         [style.border-left]="isActiveUser(acc.acct) ? '3px solid #6366f1' : 'none'"
         [style.padding]="'8px'"
         [style.border-radius]="'4px'"
         [style.display]="'flex'"
         [style.align-items]="'center'"
         [style.gap]="'8px'"
         style="text-decoration: none; color: #333; cursor: pointer; transition: all 0.2s;">
        <img [src]="acc.avatar" style="width: 24px; height: 24px; border-radius: 50%;">
        <span style="font-size: 0.9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
          {{ acc.display_name || acc.acct }}
        </span>
      </a>
    </div>

    <hr>
    <div class="muted" style="margin-bottom:10px;">LINKS</div>
    <a href="https://mastodon.social" target="_blank" class="nav-btn">My Profile</a>
  </div>

  <div class="sidebar-right">
    <div class="muted" style="margin-bottom:10px;">POST FILTERS</div>

    <button class="nav-btn" [class.active]="currentFilter==='storms' || currentFilter==='all'" (click)="setFilter('storms')">
      Storms ({{ counts.storms }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='shorts'" (click)="setFilter('shorts')">
      Shorts ({{ counts.shorts }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='questions'" (click)="setFilter('questions')">
      Questions ({{ counts.questions }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='news'" (click)="setFilter('news')">
      News ({{ counts.news }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='software'" (click)="setFilter('software')">
      Cool Software ({{ counts.software }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='pictures'" (click)="setFilter('pictures')">
      Pictures ({{ counts.pictures }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='videos'" (click)="setFilter('videos')">
      Videos ({{ counts.videos }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='discussions'" (click)="setFilter('discussions')">
      Discussions ({{ counts.discussions }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='links'" (click)="setFilter('links')">
      Links ({{ counts.links }})
    </button>

    <button class="nav-btn" [class.active]="currentFilter==='reposts'" (click)="setFilter('reposts')">
      Reposts ({{ counts.reposts }})
    </button>
  </div>

  <div class="content">
    <router-outlet></router-outlet>
  </div>

  <div class="footer">
    Powered by Mastodon & FastAPI. &copy; 2026.<br>
    <a href="https://www.flaticon.com/free-icons/elephant" title="elephant icons">Elephant icons created by Freepik -
      Flaticon</a>
  </div>
</div>

<div class="server-down-overlay" *ngIf="serverDown">
  <div class="server-down-modal">
    <div class="server-down-icon">üîå</div>
    <h2>Connection Lost</h2>
    <p>We are having trouble reaching the server.</p>
    <div class="loading-spinner"></div>
    <p><small>Attempting to reconnect...</small></p>
  </div>
</div>
